(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var get_editor_text_content,get_file_id_from_url,load_file_content,load_file_metadata,querystring,update_editor_with_content,update_file_in_drive;querystring=require("querystring");document.addEventListener("DOMContentLoaded",function(){return document.getElementById("save_button").addEventListener("click",function(event){event.preventDefault();console.log("Save button clicked.");get_file_id_from_url("id").then(function(file_id){return get_editor_text_content().then(function(content){return update_file_in_drive(file_id,content)}).then(function(file){console.log("File updated!");return console.log(file)})})["catch"](function(err){return console.error(err)});return false})});get_editor_text_content=function(){return Promise.resolve(document.getElementById("file_content").value)};get_file_id_from_url=function(key){var query;query=querystring.parse(document.location.search.slice(1));if(query[key]){return Promise.resolve(query[key])}else{return Promise.reject("file_id not found in URL.")}};window.google_client_onload=function(){var auth,auth_good;console.log("Checking if already authorised.");auth={client_id:"929534383010-hui1c2g21lphi0o9tg4rblmlqb1v4fo8.apps.googleusercontent.com",immediate:true,scope:"https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.install"};auth_good=function(){console.log("Loading Google Drive API.");return gapi.client.load("drive","v2",function(){console.log("Loading file from URL.");return get_file_id_from_url("id").then(load_file_metadata).then(load_file_content).then(update_editor_with_content)["catch"](function(err){return console.error(err)})})};return gapi.auth.authorize(auth,function(auth_result){if(auth_result&&!auth_result.error){console.log("Already authorised!");return auth_good()}else{console.log("Not already authorised. Doing that now.");auth.immediate=false;return gapi.auth.authorize(auth,function(auth_result){if(!auth_result){return console.error("Invalid response from `gapi.auth.authorize()`!")}else if(auth_result.error){return console.error(auth_result.error)}else{console.log("Authorised!");return auth_good()}})}})};load_file_content=function(file){return new Promise(function(resolve,reject){var access_token,xhr;access_token=gapi.auth.getToken().access_token;xhr=new XMLHttpRequest;xhr.onerror=function(){return reject("Failed to load file content!")};xhr.onload=function(){return resolve(xhr.responseText)};xhr.open("GET",file.downloadUrl);xhr.setRequestHeader("Authorization","Bearer "+access_token);return xhr.send()})};load_file_metadata=function(file_id){console.log("Loading metadata for file ID: "+file_id);return new Promise(function(resolve,reject){var request;request=gapi.client.drive.files.get({fileId:file_id});return request.execute(function(file){if(!file){return reject("No file metadata returned.")}else if(file.error){return reject(file.error)}else{return resolve(file)}})})};update_editor_with_content=function(content){return document.getElementById("file_content").value=content};update_file_in_drive=function(file_id,content){return new Promise(function(resolve,reject){console.log("Sending Drive update file request.");return gapi.client.request({body:content,method:"PUT",params:{uploadType:"media"},path:"/upload/drive/v2/files/"+file_id}).execute(function(file){if(!file){return reject("No file upload details returned.")}else if(file.error){return reject(file.error)}else{return resolve(file)}})})}},{querystring:4}],2:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],3:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],4:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":2,"./encode":3}]},{},[1]);
